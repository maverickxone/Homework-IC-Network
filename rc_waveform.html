<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC 电路输入输出波形</title>
    <script src="https://cdn.plot.ly/plotly-2.24.2.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f4f4f9;
        }

        h1 {
            margin-top: 20px;
            font-size: 24px;
            color: #333;
        }

        .controls {
            margin: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .controls label {
            font-size: 16px;
            color: #555;
        }

        .controls input[type="range"] {
            width: 300px;
        }

        #chart {
            width: 90%;
            max-width: 800px;
            height: 500px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>RC 电路输入输出波形及 Lissajous 图形</h1>
    <div class="controls">
        <label>频率 f (Hz): <input id="freq-slider" type="range" min="0" max="100" step="1" value="7"></label>
        <label>电阻 R (kΩ): <input id="res-slider" type="range" min="0.01" max="10" step="0.01" value="1.66"></label>
        <label>电容 C (μF): <input id="cap-slider" type="range" min="1" max="40000" step="1" value="20000"></label>
        <button id="reset-btn">重置</button>
    </div>
    <div id="chart"></div>

    <script>
        function calculate_w(f) {
            return f === 0 ? 1e-6 : 2 * Math.PI * f;
        }

        function calculate_H(w, R, C) {
            const RC = R * C * 1e-6;
            return 1 / Math.sqrt(1 + Math.pow(w * RC, 2));
        }

        function calculate_phi(w, R, C) {
            const RC = R * C * 1e-6;
            return Math.atan(w * RC);
        }

        function V_in(x, w) {
            return x.map(t => Math.cos(w * t));
        }

        function V_out(x, w, R, C) {
            const H = calculate_H(w, R, C);
            const phi = calculate_phi(w, R, C);
            return x.map(t => H * Math.cos(w * t - phi));
        }

        function get_time_axis(f) {
            if (f <= 0) return Array.from({ length: 5000 }, (_, i) => i / 5000);
            const T = 1 / f;
            const t_max = Math.min(Math.max(5 * T, 0.1), 10);
            return Array.from({ length: 5000 }, (_, i) => i * t_max / 5000);
        }

        function updateChart(f, R, C) {
            const x = get_time_axis(f);
            const w = calculate_w(f);
            const y_in = V_in(x, w);
            const y_out = V_out(x, w, R, C);

            const trace1 = { x, y: y_in, mode: 'lines', name: 'V_in(x)', line: { color: 'blue' } };
            const trace2 = { x, y: y_out, mode: 'lines', name: 'V_out(x)', line: { color: 'red' } };
            const trace3 = { x: y_in, y: y_out, mode: 'lines', name: 'Lissajous', line: { color: 'green' } };

            Plotly.newPlot('chart', [trace1, trace2, trace3], {
                title: 'RC 电路波形与 Lissajous 图形',
                xaxis: { title: '时间 (s)' },
                yaxis: { title: '电压 (V)' },
                grid: { rows: 1, columns: 2 }
            });
        }

        document.getElementById('freq-slider').addEventListener('input', () => {
            const f = parseFloat(document.getElementById('freq-slider').value);
            const R = parseFloat(document.getElementById('res-slider').value);
            const C = parseFloat(document.getElementById('cap-slider').value);
            updateChart(f, R, C);
        });

        document.getElementById('res-slider').addEventListener('input', () => {
            const f = parseFloat(document.getElementById('freq-slider').value);
            const R = parseFloat(document.getElementById('res-slider').value);
            const C = parseFloat(document.getElementById('cap-slider').value);
            updateChart(f, R, C);
        });

        document.getElementById('cap-slider').addEventListener('input', () => {
            const f = parseFloat(document.getElementById('freq-slider').value);
            const R = parseFloat(document.getElementById('res-slider').value);
            const C = parseFloat(document.getElementById('cap-slider').value);
            updateChart(f, R, C);
        });

        document.getElementById('reset-btn').addEventListener('click', () => {
            document.getElementById('freq-slider').value = 7;
            document.getElementById('res-slider').value = 1.66;
            document.getElementById('cap-slider').value = 20000;
            updateChart(7, 1.66, 20000);
        });

        // 初始化图表
        updateChart(7, 1.66, 20000);
    </script>
</body>
</html>